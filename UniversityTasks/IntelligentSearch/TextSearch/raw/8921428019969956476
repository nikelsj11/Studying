#TITLE:Возможности восстановления физических машин из бэкапов с помощью Veeam Endpoint Backup FREE

      «Уж сколько раз твердили миру», что резервное копирование как самоцель не имеет практического смысла – а имеет оно таковой, конечно же, если из резервной копии возможно быстро, корректно и легко восстановиться. Поэтому темой моего сегодняшнего поста, в продолжение предыдущего, станет восстановление физической машины из резервной копии, созданной с помощью Veeam Endpoint Backup FREE. 
Как вы, наверное, уже предположили, опции восстановления тесно связаны с настройками резервного копирования: само собой разумеется, восстановить машину целиком не получится, если были забэкаплены, скажем, только пользовательские папки. 
Рассмотрим же эти опции более подробно, для чего добро пожаловать под кат.Восстановление отдельных файлов
Эту возможность можно использовать вне зависимости от того, какой режим бэкапа был применен. Отрадно, что ради восстановления пары-тройки файлов вам не придется поднимать из бэкапа машину целиком. (Что-то это мне напоминает… как, думаю, и всем пользователям Veeam Backup &amp; Replication, котрым с его помощью доводилось восстанавливать отдельно взятые файлы.)
Итак, как можно запустить восстановление файлов:Идём в меню Start, выбираем Veeam &gt; Tools &gt; File Level Restore и запускаем его. 
В системном трее находим иконку нашего приложения, кликаем по ней правой кнопкой и выбираем команду Restore – Individual files. 
Оба этих способа перекинут нас на шаг мастера, посвященный выбору точки восстановления. 
Примечание: При необходимости можно перейти на предыдущий шаг Backup Location и там указать, где находится нужный бэкап. Это удобно, например, если нужный файл находится в бэкапе другой машины.
Можно пойти иным путем: открыть панель управления Veeam Endpoint Backup Control Panel и выбрать нужный бэкап на диаграмме, где все они представлены графически в виде прямоугольников. Изучив информацию о выбранном бэкапе и убедившись, что это именно с него мы хотим восстанавливаться, нажмём на кнопку Restore files. Что произойдет потом?
После того, как вы нажали Restore files (или прошли по шагам мастера и нажали Open), файл резервной копии будет смонтирован на файловую систему вашей в данный момент работающей машины, в папку C:\VeeamFLR, и вы сможете просмотреть содержимое бэкапа с помощью браузера Veeam Backup Browser (или браузера Windows). 
Браузер Veeam Backup Browser поддерживает следующие опции при восстановлении:Overwrite — файл будет восстановлен в исходное местоположение; если таковой файл там уже имеется, он будет перезаписан файлом из бэкапа.
Keep — файл будет восстановлен в исходное местоположение с префиксом Restored –, имеющийся в исходном месте файл не будет перезаписан.
Copy To — файл можно скопировать в другое местоположение, дополнительно можно указать, нужно ли сохранить при этом настройки прав (галка Preserve permissions and ownership).
Полезно: Можно выбрать для восстановления сразу несколько файлов\папок, нажав CTRL+SHIFT.Восстановление тома
Сразу обращаю ваше внимание на то, что такое восстановление будет возможно только если при бэкапе вы выбрали опцию Entire PC (бэкап всей машины) или Volume Level Backup (бэкап тома).
Очевидно, что результатом восстановления будет весь том.
Для запуска процесса есть аналогичные способы: выбрать Veeam &gt; Volume Restore в меню Start, либо кликнуть правой кнопкой по иконке в трее и выбрать команду Restore – Entire Volumes, либо открыть интерфейс приложения, выбрать нужный бэкап и кликнуть Restore volumes. 
Аналогично файлу, том можно восстановить в исходное либо в новое местоположение. В первом случае исходный том будет перезаписан. Во втором случае можно разместить том либо на свободном месте диска, либо на месте уже имеющихся томов, заместив их (т.е. данные будут перезаписаны взятыми из бэкапа). 
Обращаю ваше вниманин на ряд ограничений для восстановления тома, которые будут иметь место при восстановлении без использования Veeam Recovery Media:Системный том нельзя восстановить в исходное местоположение.
Нельзя восстановить том на другой, содержащий файл подкачки.
Нельзя восстановить том на другой, содержащий файл резервной копии, из которой происходит восстановление.

Указанные ограничения можно обойти, использовав восстановление с ранее созданного загрузочного носителя Veeam Recovery Media (о котором было рассказано здесь) и запустив мастер восстановления «на голое железо» Veeam Bare Metal Recovery для восстановления тома (подробнее об этом чуть позже). Шаги мастера достаточно просты; в зависимости от местонахождения бэкапа вы выбираете удаленную СХД или сервер Veeam Backup &amp; Replication и получаете возможность маппирования диска туда. Выбираете тома, которые хотите восстановить — по умолчанию, они будут восстановлены в исходное местоположение (чтобы задать другое, кликните на Customize disk mapping, затем укажите, куда должны быть восстановлены тома). Важно! Если вы указываете местоположение вручную, будьте внимательны, чтобы не стереть имеющиеся тома. (Собственно, данные затираются непосредственно во время восстановления, так что если вы передумаете насчет маппирования на этом этапе, то достаточно нажать Cancel или закрыть окно мастера, чтобы невзначай ничего не произошло.) 
Для ручного маппинга диска есть следующие опции:Apply Backup Layout — разметить как в бэкапе; диск будет размечен так же, как был на момент создания бэкапа.
Apply Disk Layout — разметить как диск; будут использованы текущие настройки разметки другого диска (который вы укажете).
Erase — стереть; текущие настройки разметки диска будут удалены.

Далее можно переходить к восстановлению.Работа с носителем Veeam Recovery Media
Как было сказано выше, с помощью ранее созданного загрузочного носителя вы можете обойти некоторые ограничения при восстановлении тома. Но, разумеется, его предназначение не только в этом, а в том, чтобы обеспечить восстановление вашей машины из хранящейся на нем резервной копии. 
Напомню, что для создания такого носителя используется специально предназначенный мастер Create Recovery Media. В зависимости от того, какой тип носителя вы выберете, вам может понадобиться поменять приоритет загрузки ОС, указав в соответствующих настройках BIOS, что загрузку следует выполнять с данного носителя. Если все сделано правильно, то после перезагрузки машины (до запуска ОС) вам будет предложено нажать любую клавишу для загрузки с Veeam Recovery Media. 
Теперь посмотрим, какие опции предлагает нам Veeam Endpoint Recovery в появившемся окне.Инструментарий
Начнем в обратном порядке, то бишь с опции Tools – а вдруг все-таки можно починиться, не прибегая к радикальному методу «Восстановление на голое железо»?
Вот что у нас тут есть:Command Prompt — ну, это и так понятно.
Reset Password — полезная вещь, позволяет вместо забытого пароля локального админа установить пустой. Если админская учетка была деактивирована, ничего страшного – утилитка может ее включить обратно, чтобы дать вам возможность залогиниться. Само собой, пароль надо будет поменять, а после того, как вы проделаете необходимые манипуляции, вернуть учетку в прежний вид (то есть деактивировать ее).Важно! Данная утилита не работает на домен-контроллере. 
Load driver — для доступа к сетевой СХД или выделенной СХД, хранящей резервные копии, нужен соответствующий драйвер для ОС — ровно то же требуется и для работы с Recovery Media. Если при создании носителя была выбрана опция Include hardware drivers from this computer, то драйверы будут загружены автоматически. Также можно использовать данную утилиту для загрузки дополнительных драйверов в случае необходимости.
Memory diagnostics (утилита Microsoft) — проверка памяти вашей машины и диагностика потенциальных проблем. Подробнее см. http://technet.microsoft.com/en-us/magazine/2008.09.utilityspotlight.aspx 
Startup repair (утилита Microsoft) — может помочь с починкой неполадок при старте Microsoft Windows (например, отсутствующие или поврежденные системные файлы или загрузочный сектор). Подробнее см. http://windows.microsoft.com/en-us/windows7/products/features/startup-repair 
Export Logs — экспорт журналов работы приложения на внешнюю СХД; очень рекомендуется иметь файлы журналов на случай обращения в службу техподдержки Veeam. 
Среда восстановления Windows
Данная среда является частью установочного пакета Windows. Если у вас имеется системный имидж Microsoft, то его можно использовать для восстановления, воспользовавшись Veeam Recovery Media для его запуска. (А можно запустить и обычным образом; подробнее см. windows.microsoft.com/en-us/windows/restore-computer-from-system-image-backup#1TC=windows-7 )Восстановление «на голое железо»
После запуска с нашего носителя нажимаем на значок Bare Metal Recovery и проходим по шагам мастера:Backup location — указываем местонахождение резервной копии – это может быть локальное хранилище (в том числе съемные устройства) или сетевое хранилище. Вполне вероятно, что мастер распознает файлы бэкапа на локальном устройстве автоматически. Если была выбрана сетевая СХД, то далее нужно указать, какой сетевой адаптер использовать для подключения (да, подключается и через WiFi), а при необходимости указать сетевые настройки. Затем вводим путь к папке общего доступа или IP-адрес сервера Veeam Backup &amp; Replication.
Restore Point — выбираем нужную точку восстановления. Обычно это самая последняя из созданных, но можно выбрать и любую другую.
Restore Mode — определяемся с режимом восстановления. Режимы «Весь компьютер» (Entire computer) и «Системный том» (System volume) не требуют ручного вмешательства и выполяют автоматическое восстановление в исходное местоположение либо на пустой диск. Ручной режим, как водится, предназначен для продвинутых пользователей – он позволяет вручную выполнять маппинг и перенос томов из бэкапа на существующий диск, что, с одной стороны, требует определенных навыков и понимания сути происходящего, а с другой – дает полный контроль над томами и их восстановлением.
Summary — наконец, еще раз внимательно проверяем настройки и запускаем процесс восстановления. При необходимости Veeam Endpoint Backup FREE выполнит ре-аллокацию разделов и восстановит данные из резервной копии. Важно! Все данные на этих томах и разделах будут перезаписаны!
Небольшое лирическое отступление про бэкап
Вернемся немножко назад (к моменту создания резервной копии) и поговорим и о том, что собой представляют бэкап по требованию и бэкап по расписанию, а также выясним, кто такой отдельно стоящий полный бэкап (standalone full backup).Бэкап по расписанию
Выполняется автоматически согласно расписанию задания резервного копирования, чьи настройки вы указываете в мастере Сonfigure backup wizard: они могут включать в себя расписание периодического запуска и\или триггеры старта. 
При первом проходе задания будет создан полный бэкап, а при последующих – инкременты; созданные точки восстановления будут храниться и удаляться в соответствии с заданным сроком хранения.
Создание резервных копий будет функционировать до тех пор, пока будет в рабочем состоянии выбранное место их хранения. Что касается повторных запусков (в случае возможной ошибки при выполнении задания), то логика такова: после любого сбоя задание будет пытаться повторно стартвать каждые 10 минут на протяжении ближайших 23 часов, после чего прекратит это делать, выдав сообщение об ошибке.
В хранилище резервных копий будут находиться вот такие файлы:.VBM – файл метаданных, который хранит всю информацию о цепочке бэкапов
.VBK – файл полной резервной копии
.VIB – файл инкремента
Бэкап по требованию
Бэкап по требованию удобен, например, когда вам нужно установить новый софт или проапгрейдить систему. Запускается он из интерфейса Veeam Endpoint Backup нажатием кнопки Backup Now. 
В результате в цепочке резервных копий создается новый инкрементальный бэкап (исключение – первый запуск, когда создается полный бэкап как начало цепочки). 
Заметим, что, в отличие от бэкапа по расписанию, такой бэкап не будет рестартовать в случае ошибки.Отдельный полный бэкап
Создает полную резервную копию, но она не будет частью цепочки и, соответственно, не подпадет под политику хранения.
Чтобы запустить создание такого бэкапа, нужно кликнуть правой кнопкой мыши по иконке в трее и выбрать команду Backup &gt; Standalone full backup. Такой процесс тоже не будет рестартовать в случае ошибки. После завершения файл резервной копии сохраняется туда же, куда и цепочка, но в отдельную подпапку. В ней вы найдете файлы .VBM и .VBK — при необходимости из них можно будет восстановиться (не забудьте перенести и эту папку с отдельным бэкапом, если будете перекладывать папки с резервными копиями).Интеграция с Veeam Backup &amp; Replication
А теперь посмотрим, что нам дает интеграция Veeam Endpoint Backup FREE с Veeam Backup &amp; Replication в плане дополнительных возможностей восстановления.Восстановление файлов
Из консоли Veeam Backup &amp; Replication очень удобно восстанавливать файлы и папки из нашего бэкапа, задействуя механизм FLR (file-level restore, то есть восстановление на уровне файлов), подробно описанный в документации. Есть только одно ограничение — нельзя восстанавливать в исходное местоположение, но можно использовать команду Copy To в Backup Browser и скопировать нужные файлы в новое место. Восстановление объектов приложений с помощью Veeam Explorers
Если вы бэкапите сервер Active Directory, SharePoint, Exchange или SQL с помощью Veeam Endpoint Backup FREE, то из такого бэкапа можно восстанавливать объекты соответствующего приложения: просто запустите восстановление на уровне файлов из консоли Veeam Backup &amp; Replication, а затем из браузера Backup Browser – соответствующий инструмент Veeam Explorer. 
Подробнее о том, как это делается, можно узнать, например, здесь.Экспорт дисков
Любой диск из бэкапа, созданного Veeam Endpoint Backup, можно экспортировать в файл VMDK, VHD или VHDX с помощью консоли Veeam Backup &amp; Replication, выбрав в меню Home команду Restore &gt; Endpoint &gt; Export disk contents as virtual disks.
Следует понимать, что это не будет восстановлением P2V, так что при попытке загрузиться с такого диска в виртуальной среде возможны ошибки из-за наличия физических драйверов. Однако есть и более практичные сценарии – например, аттач диска к ВМ. Но и здесь нужно помнить о нескольких моментах:Диск VMDK можно восстановить на СХД (datastore) в «тонком» формате (thin provisioned), тогда как восстановление на сервер сохранит диск в виде «толстого» (thick provisioned).
Диски VHD/VHDX всегда восстанавливаются как динамические.
Вместо заключения
Напоминаю, что недавно вышла версия 1.1 решения Veeam Endpoint Backup FREE, которая поддерживает Windows 10. Решение доступно по ссылке http://www.veeam.com/ru/endpoint-backup-free-download.html.
Описание продукта можно найти на страничке http://www.veeam.com/ru/endpoint-backup-free.html.
Статья на Хабре с обзором решения Veeam Endpoint Backup FREE: http://habrahabr.ru/company/veeam/blog/255729/
Статья на Хабре о резервном копировании физических машин с помощью Veeam Endpoint Backup FREE: http://habrahabr.ru/company/veeam/blog/261481/

      
      
    