#TITLE:Высокочастотный трейдинг: Руководство от героя книги Flash Boys

      
Примечание переводчика: Ранее в нашем блоге на Хабре мы рассматривали различные этапы разработки торговых систем (есть и онлайн-курсы по теме), и даже описывали разработку событийно-ориентированного бэктест-модуля на Python. Сегодня мы представляем вашему вниманию краткое руководство по высокочастотному трейдингу от Брэда Кацуямы (Brad Katsuyama) — знаменитого кванта и героя бестселлера Майкла Льюса "Flash Boys: A Wall Street Revolt" (мы публиковали в блоге адаптацию этого произведения).
В выпуске передачи Wall Street Week Брэд Кацуяма рассказал о высокочастотном трейдинге (HFT) и структуре рынка, а мы составили обзор на тему HFT-трейдинга и финансового регулирования с точки зрения процесса исполнения ордеров на бирже. Видео доступно по ссылке.Что такое высокочастотный трейдинг (HFT)?
По сути, высокочастотный трейдинг (HFT) – это проведение электронных торгов на очень большой скорости. Несмотря на то, что деятельность HFT-трейдеров часто критикуется, лишь определенные виды HFT-трейдинга создают хаос на современном финансовом рынке. Грань между алгоритмической торговлей, электронным маркетмейкингом и вредным HFT-трейдингом довольно размыта, и под высокочастотной торговлей часто подразумевают электронные торги. На самом же деле феномен HFT-трейдинга сам по себе не является ни хорошим, ни плохим, однако дьявол кроется в деталях.
Чтобы ясно представлять возможности HFT-трейдинга, стоит подробнее рассмотреть некоторые виды рыночной деятельности.Что представляет собой алгоритмический/системный трейдинг?Алгоритмический/системный трейдинг – это общее название для процесса применения программируемых систем, использующих определенную математическую модель для автоматического совершения сделок. Человек создает на компьютере программу для определенной финансовой стратегии на основе данного критерия и управляет разработанной системой с этого компьютера.
HFT-трейдинг – разновидность алгоритмического трейдинга, однако не весь алгоритмический трейдинг можно считать высокочастотным.
Что представляет собой ручной/дискреционный трейдинг?
Ручной/дискреционный трейдинг – общее название для совокупности субъективных решений, принимаемых человеком, как правило, на основе ряда субъективных критериев. Ручным трейдером может быть и мелкий инвестор, заключающий по одной сделке в месяц, и внутридневной трейдер, заключающий по несколько сотен сделок в день, и крупная организация, торгующая большими пакетами акций в различные промежутки времени.
В 2011 году Комиссия по торговле товарными фьючерсами (CFTC) признала, что не «пытается подобрать точное определение» высокочастотному трейдингу. Вместо него она предложила «семь основных признаков HFT-трейдинга»:Использование систем, реализующих чрезвычайно быстрые размещение, отмену и изменение ордера менее чем за 5 миллисекунд или с практически минимальной задержкой. 
Использование компьютерных программ или алгоритмов с целью автоматизации процесса принятия решений, в ходе которого выставление, оформление, направление и исполнение ордеров определяются системой и не требуют вмешательства человека в случае каждого отдельного ордера или сделки.
Использование сервисов колокации [англ. co-location – размещение чужих серверов вблизи биржи], прямого доступа к рынку или выделенного канала передачи данных, предлагаемых биржами и другими организациями с целью сократить сетевые и другие задержки.
Очень короткие временные рамки на открытие и закрытие позиции.
Высокий ежедневный оборот портфеля ценных бумаг и/или высокая доля выставленных заявок по отношению к количеству проведенных сделок [англ. order-to-trade ratio].
Размещение большого числа ордеров, которые аннулируются сразу или в течение нескольких миллисекунд.
Завершение торгового дня в позиции, максимально близкой к нулевой [англ. flat position] (не удерживая ночью крупных нехеджированных позиций).
Как работает фондовый рынок
Фондовый рынок был создан для того, чтобы компании могли получить доступ к государственным инвестициям и, таким образом, привлечь финансирование с целью увеличения темпов своего роста. Фондовые биржи должны были стать местом, где обычные продавцы и покупатели собирались бы вместе и заключали между собой сделки в установленном порядке. Однако после появления различных посредников фондовый рынок был разбит на большое количество сегментов, и его структура стала намного сложнее.
На данный момент торги в США проводят 11 публичных фондовых бирж, около 50 альтернативных торговых систем (ATS), также именуемых «скрытыми пулами», и около 200 интерналайзеров (как правило, это брокер-дилеры, которые могут продавать/покупать ценные бумаги, действуя от своего или чужого имени). Крупнейшими публичными биржами считаются Нью-Йоркская фондовая биржа (NYSE) и NASDAQ. Публичные биржи подвергаются серьезному влиянию со стороны регулирующих органов, в то время как системы ATS, как правило, находящиеся под контролем крупных банков и финансовых учреждений, испытывают меньше влияния со стороны властей.
Когда вы размещаете ордер на своем брокерском онлайн-аккаунте, этот ордер может быть передан на определенную биржу или в систему ATS. После выставления своей заявки вы практически сразу получаете подтверждение факта заключения сделки, однако вы не сможете увидеть, через чьи руки ваш ордер успел пройти за несколько миллисекунд.Тщательно изученные HFT-стратегии
Вскоре после резкого обвала фондовых индексов США в мае 2010 года (Flash Crash) Комиссия по ценным бумагам и биржам попыталась собрать больше информации о различных типах HFT-стратегий, неблагоприятно влияющих на рынок.1. Пассивный маркетмейкингПассивный маркетмейкинг в целом заключается в размещении заявок на покупку (бид) и продажу (аск) (лимитных ордеров) с целью обеспечения ликвидности на рынке. Игроки, покупая по биду и продавая по аску, получают прибыль с комиссии за добавление ликвидности, которая выплачивается в соответствии с биржевой моделью maker-taker.
Регулирующие органы обеспокоены качеством ликвидности, которую якобы обеспечивает пассивный HFT-маркетмейкинг. Неправильное стимулирование в модели maker-taker ведет к лейерингу [англ. Layering – манипуляция рынком путем искусственного смещения котировок на покупку и продажу ценных бумаг] и высокому уровню ранних отказов (не менее 90%).
2. АрбитражАрбитражные стратегии направлены на извлечение прибыли, исходя из разницы цен на одинаковые активы, которыми торгуют на разных торговых площадках. Арбитраж всегда будет присутствовать на финансовых рынках, но он не должен основываться на стремлении выиграть в скорости и раньше других получить доступ к биржам на связанных рынках.
Статистический арбитраж заключается в получении прибыли с разницы цен между коррелирующими ценными бумагами или рынками. Данный тип арбитража использует методы математического моделирования и может применяться на любых временных отрезках.
Арбитраж задержек [англ. latency arbitrage] заключается в использовании современных технологий с целью получения преимущества в скорости. Под задержкой понимается время, которое проходит с момента отправления сигнала до момента его получения. При обсуждении различий между вредными и безвредными типами HFT-трейдинга статистический арбитраж зачастую путают с арбитражем задержек.
3. Структурные стратегииСтруктурные стратегии, как правило, нацелены исключительно на использование уязвимостей в структуре рынка и получение необходимых рыночных данных раньше других. Для этого необходимо разместить свои серверы достаточно близко к бирже или получить прямой доступ к ее информации. Имея доступ к последним данным котировок, компании могут заработать на исполнении ордеров в том случае, если найдут игроков, до которых информация доходит медленнее.
4. Дирекционные стратегииЦелью дирекционных стратегий является извлечение прибыли путем прогнозирования направленного движения цен на ценные бумаги. Этим они отличаются от трех предыдущих типов стратегий, принимая на себя нехеджированные риски.
Используя дирекционную стратегию с ожиданием, игрок старается обнаружить крупные заявки, которые могут повлиять на цену, и выставить свой ордер раньше них. Таким образом, он может использовать эти крупные ордера в качестве «бесплатных опционов» (точек выхода) в случае, если стоимость ценной бумаги не движется в ожидаемом направлении.
При использовании стратегии «разжигания моментума» [англ. momentum ignition] компания выставляет группу ордеров в попытке «разжечь» резкое движение цены в определенном направлении. Суть принципа, получившего название «спуфинг», заключается в манипуляции алгоритмами и ручными трейдерами, которые вынуждены вести агрессивную торговлю. Кроме того, при использовании этой стратегии игрок может вызвать дальнейшее движение цены за счет выставленных стоп-лоссов. Спуфинг считается незаконной стратегией, но его сложно обнаружить и доказать.
Что представляет собой регламент системы национального рынка?
Регламент системы национального рынка (Reg NMS) – это совокупность норм и правил, утвержденных в 2005 году Комиссией по ценным бумагам и биржам США и вступивших в силу в 2007 году. Они направлены на модернизацию биржевых площадок США путем установления рыночной справедливости в ценообразовании, в способах отображения котировок и в предоставлении доступа к рыночным данным.
Ниже перечислены основные правила Reg NMS:Правило выгодного исполнения ордеров: Оно гарантирует инвесторам, что их ордера на ценные бумаги будут исполнены по лучшей цене на любой бирже. Правило создано для защиты инвесторов путем устранения недостатков в традиционных правилах торговли, так как они допускают невыгодное исполнение заявок, особенно в случае с лимитными ордерами. Несмотря на то, что это правило было разработано с благородной целью, его непредвиденные последствия негативно повлияли на структуру рынка.
Правило доступа: Следствием этого правила стало появление системы под названием «Обработчик данных по ценным бумагам» [англ. Securities Information Processor, SIP], принцип которой заключается в сборе информации по котировкам на всех публичных биржах и выдаче лучшей котировки на покупку/продажу (NBBO) по каждой ценной бумаге. Данные передаются со всех дата-центров биржевых площадок на один центральный процессор, который затем выдает универсальный спред. Регулирующие органы ввели это правило для того, чтобы устранить негативные последствия растущей фрагментации публичных бирж, однако вместо этого только увеличили их фрагментацию и спровоцировали рост торговли в скрытых пулах.
Непредвиденные последствия введения правила выгодного исполнения ордеров
Организация, которая собирается исполнить крупный ордер, скорее всего, сделает это в скрытом пуле, чтобы не раскрывать своих намерений до заключения сделки. Спред акции состоит из самого высокого бида (заявки на продажу) и самого низкого аска (заявки на покупку). Если вы выставляете рыночный ордер на покупку 200 акций, вам подберут заявку на продажу по самой низкой цене (учитывая, что размер этой заявки составляет не менее 200 акций), и ваш ордер будет исполнен по этой цене.
Но что, если вы захотите приобрести 1 000 или 10 000 акций? По мере увеличения размера заявки возникает все больше проблем. Допустим, вы хотите купить 1 000 акций, а заявка с самой низкой ценой на «внутреннем рынке» рассчитана только на 100 акций. Пусть цена за акцию в этой заявке на продажу составляет $10,10, еще 1 000 акций выставлено на продажу чуть дороже – $10,11 за штуку, и затем предлагается приобрести 900 акций по цене $10,15 за штуку. 
Если вы выставляете рыночный ордер на 1 000 акций, в первую очередь его должны исполнить по «лучшей цене»: в нашем случае это 100 акций по $10,10. Сразу после исполнения вашей заявки биржа, на которой она была исполнена, выдает подтверждение о совершении сделки на 100 акций по $10,10. После этого вы можете надеяться, что к остальной части вашей заявки добавят 900 из 1 000 акций, продаваемых за $10,11. Однако зачастую дела обстоят несколько иначе.
Как только на рынке появляется подтверждение на покупку 100 акций по $10,10, компьютер может отбросить предложение о продаже 1 000 акций по $10,11, и ваша заявка автоматически примет следующее «лучшее» предложение о продаже 900 акций по $10,15. Средняя цена вашей сделки составит $10,145. В данном случае проблема состоит в том, что нельзя принять предложение по цене $10,11 после покупки акций по $10,10, не дав рынку предварительного сигнала о своем намерении. 
Для мелкого индивидуального инвестора разница в цене, возможно, окажется не критичной, но для крупных организаций вроде пенсионных и взаимных фондов [англ. mutual funds], в которых хранятся деньги большей части населения США, регулярное увеличение средней цены сделки со временем может привести к значительным финансовым потерям.Как появились скрытые пулы
Считается, что скрытые пулы приобрели еще большую актуальность в результате экономического стимулирования, возникшего из-за несовершенства законодательства. Скрытые пулы появились в 1980-х годах, когда крупные инвестиционные организации пытались отыскать такой способ заключения сделок друг с другом, при котором не нужно выплачивать комиссии и оставаться при этом скрытыми от глаз публичных бирж. Они хотели получить возможность покупать и продавать большие пакеты акций, не раскрывая своих планов публичным биржам и проводя, таким образом, более выгодные сделки. 
В 1998 году Комиссия по ценным бумагам и биржам заложила основу сегодняшней рыночной структуры после того, как в силу вступили нормы регулирования альтернативных торговых систем (Reg ATS), а затем в 2007 году ввела ряд дополнительных норм регулирования для системы национального рынка (Reg NMS).Рост торговли в скрытых пулах
Более прозрачные публичные биржи обычно относят к «белым рынкам», тогда как менее прозрачные альтернативные торговые системы и скрытые пулы обычно относят к «теневым рынкам». Описанная выше ситуация является одной из главных причин, по которым развивается торговля на «теневых рынках», проводимая, в частности, крупными инвестиционными организациями.
В 2005 году, еще до вступления в силу норм регулирования системы национального рынка, на долю скрытых пулов приходилось 3-5% объема рынка. Сегодня этот показатель составляет 15-18% и продолжает расти. Примерно 40% всего объема сделок проходит через систему предоставления отчетности о торговой деятельности предприятий [англ. Trade Reporting Facility, TRF]. Она охватывает всю «внебиржевую торговлю», включая деятельность альтернативных торговых систем, торговлю на рынке «верхнего яруса» [англ. upstairs trading] (когда биржевые трейдеры напрямую ведут переговоры друг с другом и заключают крупные сделки) и розничный поток заявок. Кроме этого, по оценкам Tabb Group, 54% рынка производных финансовых инструментов приходится на высокочастотный трейдинг.
Почему? Если говорить простым языком, крупные организации могут торговать в скрытых пулах анонимно и не сообщать о закрытии крупной позиции. Развитие теневой торговли оказало негативное влияние на естественный процесс ценообразования. Брокер-дилеры и крупнейшие инвестиционные банки, учитывая последствия вступления в силу новых норм регулирования, поспешили организовать несколько скрытых пулов, чтобы переманить поток ордеров крупных организаций.
Теперь вместо того, чтобы стать местом встречи обычных покупателей и продавцов – а первоначально этим местом должны были стать фондовые биржи – для некоторых учреждений они стали последним шансом на получение ликвидности. Несмотря на то, что 60% торгов все еще проводится на «белых рынках», биржи вызывают много проблем из-за ордеров, привлеченных в систему выплаты комиссий в модели maker-taker (и обратной ей модели taker-maker). И хотя публичные биржи сегодня являются источником стабильной ликвидности, реальность такова, что их активность и надежность постепенно снижаются. Непредвиденные последствия обработки данных по ценных бумагам
Помимо прочего, регламент системы национального рынка предусматривает создание обработчика данных по ценным бумагам (SIP), который является нормой регулирования, допускающей реализацию арбитражных стратегий. Эти стратегии являются одной из основных тем, которые волнуют противников HFT-трейдинга.
SIP представляет собой централизованный процессор, на который все биржи отправляют свои рыночные данные с целью создания универсального «внутреннего рынка» для каждой ценной бумаги, зарегистрированной на бирже. Всего имеется два SIP-процессора: один работает с ценными бумагами, зарегистрированными на NASDAQ, и размещается на ее технологических платформах, а второй работает с ценными бумагами Нью-Йоркской фондовой биржи и других организаций, торгующих с помощью технологических платформ NYSE. Одним словом, все 11 публичных бирж подключаются с помощью кабеля к SIP-процессорам, которые, в свою очередь, собирают полученные данные, анализируют их и выдают лучшие котировки (NBBO) ценных бумаг.
Процесс передачи рыночных данных с биржи на SIP-процессоры занимает доли секунды. Так что, если учесть тот факт, что сигнал передается с разной скоростью в зависимости от того, насколько близко к бирже располагаются серверы ее клиентов, то возникает небольшой лаг по сравнению с «прямым потоком данных».
Что значит прямой поток данных? На каждой бирже есть прямой поток данных, предоставляющий данные котировок тем, кто «подписан» на него, быстрее остальных. Чем ближе вы находитесь к серверу биржи (или используете СВЧ-связь), тем быстрее вы получите и передадите эти данные. Что касается задержки, то вы должны понимать, что мы живем в мире, где решающую роль может сыграть несколько миллисекунд или даже микросекунд.
HFT-фирмы готовы выложить приличную сумму денег, чтобы разместить свои серверы рядом с серверами бирж. Так они могут получать данные быстрее, чем от более медленного SIP-процессора. Движок биржи, сводящий вместе заявки на покупку и продажу, в свое время находился в торговом зале Нью-Йоркской фондовой биржи, и с ним работал отдельный специалист. Сегодня такие движки размещают в больших помещениях вместе с серверами биржи.
Сторонники HFT-трейдинга утверждают, что получить прямой доступ к бирже и установить рядом с ней свои серверы может каждый, однако в действительности этим занимаются солидные компании, у которых есть средства на разработку и реализацию HFT-стратегий в крупных масштабах. Услуги размещения серверов рядом с биржей приносят ей неплохую прибыль, если вспомнить о том, что биржа – это в первую очередь коммерческая организация. HFT-компании платят десятки миллионов долларов, чтобы установить свои серверы в здании биржи: спрос на услуги предоставления места, связи, скорости и пропускной способности довольно высокий.
В итоге HFT-фирмы получают данные быстрее за счет прямого доступа к бирже, тогда как весь остальной рынок следит за котировками, которые передает более медленный SIP-процессор. Благодаря этому HFT-компании могут использовать арбитраж задержек для того, чтобы опередить другие ордера и, таким образом, заработать на большом числе сделок. Формально такая стратегия отличается от «игры на опережение» [англ. front-running] и, скорее, является лазейкой, возникшей в результате конфликта интересов и различий в механизмах стимулирования.Layering и отмена ордеров
Если вы посмотрите на текущее состояние фондового рынка США, вам покажется, что это самый ликвидный финансовый рынок за всю историю, однако у него есть ряд серьезных недостатков.
Защитники HFT-трейдинга считают, что фондовый рынок находится в состоянии, наиболее благоприятном для обычного индивидуального инвестора. Величина спреда сократилась, объемы сделок увеличились, и это ведет к более выгодному исполнению ордеров и низким комиссионным сборам. На первый взгляд, такая ситуация должна устраивать относительно мелких индивидуальных инвесторов, которые не заключают крупных сделок на постоянной основе.
Однако от разрушительного действия арбитража HFT-компаний, основанного на задержках, больше всех пострадали крупные организации, извлекающие прибыль из крупных сделок. Доход от высокочастотной торговли распределяется по всему рынку, но его большая часть сконцентрирована в руках нескольких HFT-фирм.
Ранее мы уже мы рассказали о методе, с помощью которого агрессивные HFT-компании применяют стратегии арбитража задержек: таким образом, они могут манипулировать стаканом ордеров, не давая возможности участникам рынка исполнить свои заявки по лучшей средней цене. Хотя это лишь один из возможных сценариев, рынок и в самом деле забит ордерами, которые никто и никогда не собирался исполнять: они скорее служат приманкой, чтобы привлечь других игроков рынка и завладеть их деньгами.
Когда сторонники HFT-трейдинга говорят о достоинствах быстрой автоматической торговли, они упускают из виду тот факт, что большая часть ликвидности – всего лишь иллюзия. Часто бывает, что мы видим минимальный спред каких-либо акций, но размер заявки на внутреннем рынке может быть настолько мал, что ни один трейдер не станет ее исполнять. Когда трейдер выставляет рыночный ордер небольшого размера, все остальные заявки большего размера за пределами внутреннего рынка тут же исчезают, и трейдер понимает, что не сможет заключить такую сделку. Главный экономист Банка Англии Энди Холдейн однажды сказал: «Высокочастотная торговля добавляет ликвидности в сезон дождей и забирает ее в засушливый период» [в английском языке словом «liquidity» обозначают не только ликвидность, но и состояние текучести – прим. перев.]. Модель maker-taker
С развитием теневой торговли коммерческим биржам приходится удерживать потоки ордеров, с которых они получают свой доход. Услуги колокации и дополнительные сборы составляют значительную часть их прибыли, однако биржи вынуждены поддерживать стабильный поток ордеров, чтобы оставаться конкурентоспособными. 
Чтобы переманить потоки ордеров, перетекающие в скрытые пулы – которые обычно могут сделать более выгодное предложение – биржи прибегают к такой противоречивой практике, как плата за поток ордеров. Ее суть заключается в том, что биржи и оптовые предприятия платят каждому отдельному брокер-дилеру за направление его ордера по конкретному маршруту. В качестве компенсации за отправленный поток ордеров биржа выплачивает брокер-дилеру вознаграждение по лимитным ордерам за каждую акцию. Это вознаграждение обычно составляет долю пенни за акцию (0,002 или 0,003 цента), но если речь идет о нескольких миллионах акций, то общая сумма получается довольно внушительной. 
Один из вариантов такой схемы используется при отправлении потока ордеров крупными организациями: эта модель носит название maker-taker. Не так давно она вызвала настоящий гнев противников HFT-трейдинга. Согласно этой модели, вы считаетесь «источником» (maker) ликвидности, когда выставляете заявки на покупку и продажу (лимитные ордера) на биржу и получаете вознаграждение сразу после того, как другая сторона примет размещенную вами заявку. В то же время вы становитесь «получателем» (taker) ликвидности, когда принимаете заявки на покупку или продажу (рыночные ордера или агрессивные лимитные ордера) и фактически платите за это штраф. За последние несколько лет величина вознаграждения заметно выросла, так как каждая биржа борется за свой кусок уменьшающегося пирога из потока ордеров, все еще проходящих через «белые» рынки.
Введение платы за потоки ордеров и сам факт использования модели maker-taker далеки от реального назначения финансовых рынков, которое заключается в создании площадки, сводящей покупателей и продавцов в установленном порядке и благоприятствующей естественному ценообразованию, которое является результатом действия закона спроса и предложения. Если бы ситуация не была искажена в результате неправильного стимулирования, которое способствовало развитию теневых рынков, введение вознаграждений было бы излишним.Выводы и будущее high frequency-трейдинга
Если Майкл Льюис несколько приукрасил текущее состояние фондового рынка, назвав его «технически развитым» в своей книге Flash Boys, то, по крайней мере, он дал старт очень важному для всей финансовой индустрии обсуждению на тему того, в правильном ли направлении идет развитие финансовых рынков. 
Скоростная гонка вооружений привела к перенасыщению и консолидации HFT-индустрии. Крупные рыбы съедают более мелких; сегодня выживают лишь самые быстрые HFT-компании с наибольшим объемом ресурсов. Любые HFT-стратегии можно переделать под себя, а значит, если одна HFT-компания узнаёт о стратегии другой, значит, она может разработать на ее основе высокоскоростной алгоритм и завладеть преимуществом. Если пирог, состоящий из потенциальной прибыли от арбитража задержек, все еще остается большим, с течением времени многим игрокам HFT-индустрии будут доставаться все меньшие куски.
Чтобы восстановить справедливость на финансовом рынке, нам нужно улучшать его регулирование и использовать возможности для свободной торговли. Новые ориентированные на инвесторов биржи помогут выровнять ситуацию на рынке. Нормы регулирования всегда должны быть максимально простыми и эффективными, чтобы соответствовать первоначальной цели фондового рынка, а именно – стать местом, где организованно будут подбираться пары покупателей и продавцов. Неправильная мотивация привела к появлению целых групп посредников, что не соответствует нашей конечной цели – совершению сделок в условиях свободного рынка.
      
    