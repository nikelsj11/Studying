#TITLE:Indoor навигация и позиционирование – доводилось ли вам «терять» машины на парковке?

      Приходилось ли вам часами ходить по торговому центру в поисках вещи, которую вы уже видели в одном из магазинов, но не можете вспомнить, где именно? Или искать в музее самый интересный экспонат? Знакома ли вам ситуация, когда вы, выйдя из торгового центра, долгое время искали автомобиль на парковке?
У меня как-то «пропала» машина на многоуровневой парковке в Дубае, которую я потом искала часа два на сорокаградусной жаре. Уже собралась в полицию заявлять об угоне, но именно в этот момент случайно на нее наткнулась.
Или, например, музеи – Большой Гатчинский дворец в пригороде Санкт-Петербурга. 
Огромное количество залов на нескольких этажах. Можно и в подземелье забрести, в котором находится целый лабиринт ходов, вот тогда уже точно самостоятельно не выбраться.
К слову о подземельях, в метро, например, постоянно встречаются люди с тележками и чемоданами, озирающиеся по сторонам, пытающиеся разобраться, где они находятся и куда им идти. 
Чтобы помочь людям ориентироваться на местности, придумывают все новые способы. Один из наиболее простых и технологичных — indoor навигация и позиционирование.
В этой статье на примере компании Navigine, специализирующейся на indoor навигации, мы рассмотрим, как небольшая компания-разработчик может интегрировать свое специфическое решение с продуктами SAP. Несмотря на то, что рынок indoor сервисов уже несколько лет активно развивается, решение Navigine на платформе SAP HANA является передовым на российском рынке.
Что позволяет это решение, чем и как оно может помочь, почему именно на платформе SAP HANA? Об этом позже, а для начала — краткая справка по основным технологиям, которые можно реализовать на практике в современных смартфонах.GPS  — всем знаком, есть в каждом смартфоне, но не работает в здании с приемлемой точностью. Можно поставить ретрансляторы GPS сигнала, но стоимость решения будет заоблачной.Позиционирование по сотовым сетям – точность оставляет желать лучшего даже в районах с высокой плотностью базовых станций.Инерциальные системы  — стары как мореплавание. В них используется модель движения человека: если мы знаем, где были, в какую сторону и как быстро двигались, то можно рассчитать, где мы оказались через некоторое время. Сейчас это достигается с помощью гироскопов и акселерометров смартфона. К плюсами данного решения можно отнести автономность и отсутствие привязки к внешней инфраструктуре. Минусы — необходимость знать начальную точку, со временем накапливающаяся погрешность и потребность сверяться с другим источником данных, например, GPS.Оптические системы – было несколько стартапов, которые предварительно сканировали помещения, а потом по картинке, например, потолка c фронтальной камеры смартфона, определяли местоположение. Интересно, но требует съемки помещения и пока не попадалось полноценной реализации.Магнитометрия – навигация по магнитному полю с помощью компаса смартфона. Есть примеры успешных применений, но решение требует предварительной калибровки в помещении и слишком подвержено влиянию металла и магнитов.Трилатерация на базе Wi-Fi/Bluetooth передатчиков. Плюсы: применение знакомого, недорогого и распространённого оборудования, как для инфраструктуры, так и для позиционирования (все необходимое есть в смартфонах). Возможность использования уже развернутых Wi-Fi/Bluetooth сетей. Основной минус – точность около 10 метров.Радиокарта или “цифровые отпечатки” сигналов Wi-Fi/Bluetooth – местоположение вычисляется путем сравнения измеряемых в реальном времени мощностей сигнала от окружающих Wi-Fi/BLE точек с заранее измеренными значениями, привязанными к карте помещения. Плюсы такие же, как и в случае с трилатерацией. Недостатки – точность около 5 метров, необходимость предварительного обучения системы.
Есть еще много технологий и подходов: RFID, ZigBee, ИК и ультразвуковые системы, но все они по разным причинам не нашли своего применения в indoor навигации на базе смартфонов. 
Ниже я расскажу, что из этого использует Navigine.
Теперь про применение. Рассмотрим два кейса – с точки зрения пользователей и с точки зрения предприятий.
Если говорить о простых пользователях, то система помогает людям ориентироваться внутри больших зданий, в таких, как торговые центры, где они могут заблудиться, или хотят найти конкретный товар.
Принцип прост — посетители ТЦ используют мобильное приложение, которые позволяет им ориентироваться,
находить нужные магазины и товары, которые они хотят купить, быстро отыскать машину на парковке. 
Решение полезно и для самого ТЦ. Во-первых, это аналитика: где ходили посетители, по какому маршруту, сколько времени провели в магазинах, а сколько просидели на фудкорте. Во-вторых, это возможность предоставить арендаторам дополнительный мобильный канал маркетинговых коммуникации с посетителями. Типичное взаимодействие: в магазине есть скидка, посетитель, зайдя в ТЦ, получает ее в виде уведомления на смартфон. Если ему интересно, то он нажимает «проложить маршрут» и идет в этот магазин. Имея доступ к аналитике посещений ТЦ и информации из своей базы программы лояльности, арендатор может предложить индивидуальную скидку и сделать предложение, от которого не возможно отказаться.
Таким образом, для арендаторов, работающих в ТЦ – это возможность привлечь дополнительный поток посетителей в свои кафе и магазины, расширить базу лояльных клиентов и повысить средний чек.
Что касается предприятий, то перед ними часто стоит задача отслеживать, где находятся сотрудники, перемещается техника, расположены грузы и тд. За счет этого можно повысить трудовую дисциплину и безопасность на производстве, ускорить обслуживание или ремонт оборудования (сотрудники будут передвигаться оптимальным маршрутом между объектами, требующими внимания), а также организовать перемещение техники по складу наиболее эффективным способом. 
Теперь от слов к практике. Решение Navigine демонстрировалось на SAP Форуме, который собрал несколько тысяч участников.
Для SAP Форума было написано мобильное приложение, которое позволяло гостям видеть на карте помещения свое местоположение относительно стендов компаний, представленных на форуме. Кроме того, в приложение была добавлена система лояльности. Она состояла в том, что гости, посещая сессии и стенды, могли оценивать их качество, выставляя баллы. За каждую оценку они получали очки, которые дальше конвертировались в подарки от SAP. Нашим алгоритмом была предусмотрена и исключена ситуация, когда человек стоит в одном месте и делает вид, что он находится на всех сессиях и их оценивает, т.к. системе было хорошо известно, где он находится.
С помощью мобильного приложения также осуществлялся сбор маршрутов перемещений посетителей форума с последующей отправкой в облако. Из облака эта информация подгружалась в web-интерфейс в виде тепловых карт. 
Тепловая карта – это карта здания, на которой показаны самые посещаемые места на карте. 
Как ее можно применить? Например, в том же торговом центре легко определить трафик посетителей через определенные магазины. С помощью этой информации ТЦ может вести переговоры с магазинами по арендным ставкам. Например, приходит магазин А и утверждает, что к ним стало заходить меньше людей, при этом прося снизить аренду. А представители ТЦ им отвечают: «Смотрите, через ваш и через магазин Б, работающий в том же сегменте, проходит одинаковое количество людей, просто Б умеет их правильно конвертировать, а вы – нет». 
Это можно использовать и в организации работы персонала. Есть объекты с большим трафиком людей, где время от времени появляются «узкие места». Возьмем аэропорт. Там есть несколько таких мест, например, паспортный контроль или пункт личного досмотра пассажиров, где важно выставить правильное количество персонала в нужное время, чтобы не создавать «пробки». С помощью тепловой карты такие пробки легко отслеживать и оперативно от них избавляться. 
Вернемся к SAP форуму. Чтобы в павильоне работала навигация, мы расставили Bluetooth LE маяки.
Они автономные и передают сигнал на расстояние до 70 метров, от батарейки могут работать 2-3 года. У них нет внутренней памяти, они не подключается к смартфону, их функция — трансляция своего ID. Когда смартфон принимает сигнал от нескольких маяков и знает его силу, то можно с некоторой точностью определить, где находится телефон. Кроме Bluetooth LE маяков также используются внутренние датчики смартфона – гироскоп, акселерометр, барометр, компас.
«Наша ключевая компетенция – алгоритмы обработки разнородной навигационной информации. Берется сигнал от маячков, данные от сенсора смартфона, все это обрабатывается – получаются точные координаты смартфона в здании. Точность – 1-3 метра при плотности установки Bluetooth маяков 10 штук на 1 000 квадратных метров» — говорит директор компании Navigine Алексей Панёв.
Технически вся система работает следующий образом: есть приложение Navigine под Android, в котором, в зависимости от требуемой точности, либо делается замер радиокарты («цифровых отпечатков», упомянутых выше), либо на карте указываются места расположения маяков (для трилатерации). После установки всех маяков их местоположение сохраняется на сервере. Так как Apple закрыла доступ к Wi-Fi API, предпочтение отдается Bluetooth LE маякам как более универсальному и простому в установке c нуля решению — не нужны розетки и интернет.
На вход навигационных алгоритмов подаётся следующая информация:
1. Доступные сигналы радиополей (Bluetooth LE, Wi-Fi);
2. Данные внутренних датчиков смартфона (MEMS акселерометры, гироскопы, магнитометр);
3. Информация о карте помещения. Здесь важным является расположение стен, лестниц, препятствий, дверей и других объектов.
Далее используется секретный соус в виде специальных навигационных алгоритмов обработки, и на выходе получается точка на карте. В идеальном случае точность определения местоположения составляет 1 м (1 σ). 
Для обеспечения кроссплатформенности, написанные на C++ алгоритмы оборачиваются нативно в Android и iOS SDK (в перспективе и на Windows 10). 
Все вычисления происходят непосредственно на смартфоне, что позволяет снизить задержку в определении местоположения.
Так почему для реализации сервисов была выбрана именно SAP HANA?
Сервисы indoor навигации и позиционирования в первую очередь применимы для больших компаний – аэропорты, торговые центры, заводы, склады. Таким образом, существует большая база потенциальных заказчиков на решение, и оптимизируются затраты на внедрение за счет того, что интеграция во многих случаях будет происходить на одних и тех же платформах. 
Достоинства SAP HANA, которые нам удалось опробовать на себе:
1. Легкая настройка SAP HANA instance на Amazon Cloud;
2. Полный набор документации для разработчиков, включая внятные online курсы;
3. Простой перенос кода приложений на Java в окружение SAP HANA;
4. Удобные инструменты для работы через Eclipse. 
В базовом варианте все данные передаются на облачный сервер, на нём уже происходит обработка данных. На SAP форуме архитектура решения выглядела следующим образом:
1. Мобильное приложение SAP Forum с помощью встроенного Navigine SDK отправляло данные о местоположении пользователя и отмеченные им стенды и доклады на сервер;
2. Данные записывались в SAP HANA, сервер был расположен в облаке Amazon;
3. На основании собранных данных, Java web-приложение, функционирующее на SAP HANA, строило тепловую карту посещаемости форума в режиме онлайн.
Всего за 1 день форума было собрано 498 треков разных пользователей.
Таким образом, SAP Форум стал демонстрационной площадкой, на которой были показаны возможности и аналитические инструменты платформы Navigine на базе платформы SAP HANA. Форум показал, что такие сервисы можно применять в различных кейсах клиентов – в торговых центрах, в аэропортах, на предприятиях розницы, в музеях, на складах и на заводах. Взаимодействие с SAP позволяет маленьким компаниям, разрабатывающим инновационные решения, получать доступ к абсолютно новым и большим по объему рынкам корпоративных клиентов. 
А есть ли у вас лично или в вашей компании потребности в indoor навигации, и какие интересные сферы ее применения вы видите?

      
      
    