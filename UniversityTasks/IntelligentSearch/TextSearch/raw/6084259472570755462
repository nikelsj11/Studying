#TITLE:Настройка Siebel Email Marketing Server

      ВведениеSiebel CRM – это про взаимодействие с клиентами в рамках трех основных групп процессов: продажи, маркетинг и обслуживание. Siebel по умолчанию поддерживает практически все основные каналы взаимодействия: Email, SMS, CTI, Web. В данной статье рассмотрим только возможности, которые предоставляет Siebel для маркетинга в рамках канала Email.Задача: Настроить инфраструктуру для проведения маркетинговых Email-рассылок. Данная инфраструктура должна позволять собирать информацию о недоставке сообщений, открытии сообщений и переходов по ссылкам внутри сообщений. Письма должны быть персонифицированными, то есть содержать обращение к клиенту по имени. Списки получателей должны генерироваться автоматически в соответствии с указанными критериями в момент запуска кампании. Должна быть возможность указывать специфичную информацию по конкретному предложению, конкретному пользователю.Примечание:  Протокол SMTP, по которому происходит отправка писем в интернете, НЕ предполагает отчетов о доставке и о действиях получателя с письмом: открытии, удалении, пометке как спам. Хорошая новость в том, что по умолчанию есть отчеты о проблемах с доставкой (bounced email). Если проблем не случилось, можно с определенной уверенностью утверждать, что письмо получено. Также есть способ отследить открытие письма. К сожалению, у этого способа есть свои ограничения.
Для настройки Email рассылок в Siebel, помимо базового набора программных модулей (Siebel Web Server, Siebel Application Server(s), Siebel Gateway, Siebel Database), потребуется установить дополнительные:SMTP Relay Server – любой почтовый сервер, который умеет отправлять электронные письма, и у которого есть возможность взаимодействия без аутентификации.
Email Sending Daemon (ESD) – утилита, которая позволяет собирать письма из шаблона и определенного набора данных и отправляет их на SMTP Relay Server.
Bounced Handling Daemon (BHD) – утилита, которая умеет получать и разбирать отчеты о проблемах с доставкой (bounced email).
Click Through Daemon (CTD) – утилита, которая умеет обрабатывать HTTP-запросы (переходы по ссылкам, запрос ресурсов). Эта штука нам понадобится для фиксирования информации об открытии письма и о переходах по ссылкам внутри этого письма.
Network Gateway – маршрутизатор на сервере, который с одной стороны доступен из Интернета, с другой может пересылать определенные запросы во внутреннюю сеть компании. Его настройка необходима для того, чтобы пересылать bounced email (порт 25) на сервер с BHD и транслировать HTTP-запросы (порт 80) на сервер с CTD.
 Business Intelligence (BI) – инструмент, который позволяет определять сложные критерии для выборки данных по клиентам. В рамках нашей инфраструктуры у BI есть две задачи: сегментирование клиентской базы для маркетинговой кампании, формирование списка с данными для подстановки в тело письма. Данные для этих операций BI может брать как из базы данных Siebel, так и из хранилища.
Базовая настройка
Если до этого момента на проекте маркетинговые кампании в Siebel никак не использовались, то необходимо выполнить следующее:запустить необходимые серверные компонентыdocs.oracle.com/cd/E14004_01/books/MKTG_InstallAdmin/mktg_installadmin_installmktg4.html#wp186724
активировать маркетинговые Workflowdocs.oracle.com/cd/E14004_01/books/MKTG_InstallAdmin/mktg_installadmin_installmktg5.html#wp186830
настроить интеграцию с BI (предполагаю, что он уже установлен и работает)docs.oracle.com/cd/E14004_01/books/MKTG_InstallAdmin/mktg_installadmin_installmktg7.html#wp224347
Установка и настройка основных компонент Siebel Email Marketing Server
ESD, BHD и CTD вместе называются Siebel Email Marketing Server. Дистрибутивы для этих утилит можно скачать с сайта support.oracle.com, раздел “Patches &amp; Updates”Примечание: На момент написания статьи самая последняя сборка имела номер 629.Примечание: Для работы этих компонент на целевых серверах должна быть установлена JDK6.Email Sending Daemon
Для настройки ESD необходимо внести следующие изменения в файл esd.properties. При старте ESD авторизуется в Siebel для проверки наличия лицензии на использование Siebel Marketing Server. Для этого он использует технологию Web Service:esd.handler.webservice.url=http://sbl81srvr01/eai_enu/start.swe?SWEExtSource=WebService&amp;SWEExtCmd=Execute&amp;WSSOAP=1 
esd.handler.webservice.username=ESD
esd.handler.webservice.password=ESD
 Для того, чтобы ESD смог собирать письма, ему необходим список с данными получателей и шаблон письма. Siebel будет выкладывать эти данные в виде файлов в свою файловую систему, к которой ESD должен иметь доступ:esd.mountPoint=c:/Siebel/fs
 ESD должен знать имя почтового сервера (SMTP Server), через который будут отправляться письма:esd.mailServers=sbl81srvr01

Запускать ESD проще всего как сервис. В Window для этого предусмотрен специальный инсталлятор: install-win32-service.bat. Примечание: Ещё одно действие, которое необходимо произвести перед стартом ESD: в файле esd-axis2.xml закомментировать строки вида: &lt;parameter name="Transfer-Encoding"&gt;chunked&lt;/parameter&gt;. 
Это связанно с ошибкой, которая описана на support.oracle.com.
Если все настроено верно, то после запуска в логах (esd.log) можно увидеть следующее:2015-08-26 17:21:06,362 [Thread-1] INFO  OnPremiseAppListener ESD is licensed.
Теперь нужно сказать Siebel, где находится ESD, чтобы давать ему задания на рассылку. Для этого нужно:перейти на экран Administration – Web Services --&gt; Outbound Web Services
найти сервис с именем SendMailingService
для Service Port с именем SendMailing нужно указать адрес сервера, где развернут ESD

Теперь связка Siebel‒ESD должна работать и Siebel сможет ставить задачи для ESD по отправке писем.Bounce Handling Daemon
Для настройки BHD необходимо внести следующие изменения в файл bhd.properties. Параметры доступа к Web Service в Siebel, через который BHD будет проверять наличие лицензий при старте и отправлять информацию обо всех полученных bounced email:BhdModule.handler.webservice.url = http://sbl81srvr01/eai_enu/start.swe?SWEExtSource=WebService&amp;SWEExtCmd=Execute&amp;WSSOAP=1
BhdModule.handler.webservice.username = BHD
BhdModule.handler.webservice.password = BHD
 Номер порта, который BHD будет слушать и ожидать получения bounced email:SMTPD.port=8096Лучше не использовать стандартный порт 25, для него нужны права администратора. Проще всего задать порт в диапазоне от 8000‒8900.

Если все настроено верно, то после запуска в логах (bhd.log) можно увидеть следующее:2015-08-26 18:20:48,823 [main] INFO  OnPremiseMain BHD is licensed.
….
2015-08-26 18:20:49,104 [main] INFO  SMTPDaemon started; waiting for connectionsClick-Through Daemon
Для настройки CTD необходимо внести изменения в файл ctd.properties  Параметры доступа к Web Service в Siebel, через который CTD будет проверять наличие лицензии при старте и отправлять в Siebel информацию обо всех HTTP-запросах, которые будут генерироваться при работе получателя с письмом (переход по ссылкам, запрос картинок)ctd.webservice.url = http://sbl81srvr01/eai_enu/start.swe?SWEExtSource=WebService&amp;SWEExtCmd=Execute&amp;WSSOAP=1
ctd.webservice.username = CTD
ctd.webservice.password = CTD 

Данную утилиту также можно установить как Windows-сервис с помощью скрипта install-win32-service.bat.
Если все настроено верно, то после запуска в логах (ctd.log) можно увидеть следующее:2015-08-26 18:31:49,365 [Thread-1] INFO  OnPremiseAppListener CTD is licensed.
…
2015-08-26 18:31:49,443 [Thread-1] INFO  Registry Options configured for service: class com.siebel.sem.ctd.integrated.CTDRegisterWebService
2015-08-26 18:31:49,443 [Thread-1] INFO  Registry Registering [urn:xml-initialize-ctd] with class [com.siebel.sem.ctd.integrated.CTDRegisterWebService]Примечание:  В папке c:\Siebel\EMS\ctd\webapps\ctd\enu\ есть шаблоны страниц, которые используются, если получатель письма решает отписаться от рассылки. Их можно доработать в соответствии с фирменным стилем компании.Siebel Setup
Для того, чтобы использовать BHD и CTD, необходимо провести настройку на уровне Siebel. На экране Administration – Marketing  Servers нужно найти запись Email Marketing Server и для параметров BHD и CTD имя сервера, который выступает шлюзом между интернетом и локальной сетью предприятия. 
Важно указывать именно доменное имя, а не IP-адрес. Кроме того, это доменное имя должно разрешаться из интернета. Если не соблюдать эти условия, то внешние почтовые сервисы будут интерпретировать ваши письма как спам.Network Gateway
На маршрутизаторе, на который будут приходить bounced email и HTTP-запросы, должна быть настроена пересылка пакетов с внешнего сетевого интерфейса на внутренний:пакеты, которые приходят на порт 25 внешнего интерфейса, пересылать на сервер, где развернут BHD, на порт, который он слушает;
пакеты, которые приходят на порт 80 внешнего интерфейса, пересылать на сервер, где развернут CTD, на порт, который он слушает.

На внешнем интерфейсе важно использовать именно эти порты, иначе будут проблемы с внешними почтовыми сервисами.Тестовая рассылка
Письма, которые уже отправлены, назад вернуть не получится. Поэтому перед отправкой всегда нужно делать рассылку на какие-то заранее определенные тестовые адреса. Для этого можно через List Management создать фиксированный список и привязать его к той маркетинговой кампании, которая будет использоваться.
Для того, чтобы проверить, что мы все правильно настроили, нам нужно сделать следующее:создать тестовый список рассылки в List Management
создать тестовое предложение (Offer) и определить для него Email-обращение (Treatment)
создать маркетинговую кампанию, связать её с тестовым списком и Email-обращением
запустить эту маркетинговую кампанию

В следующем материале мы остановимся подробнее на создании Email-обращений. Именно там происходит много интересного.

      
      
    